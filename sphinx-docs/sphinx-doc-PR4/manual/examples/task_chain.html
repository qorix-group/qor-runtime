<!DOCTYPE html>

<html lang="Rust" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Task Chain Example &#8212; Runtime draft documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/documentation_options.js?v=a7dc471f"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Simple Inter-process Example" href="simple_example_interprocess.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="task-chain-example">
<h1>Task Chain Example<a class="headerlink" href="#task-chain-example" title="Link to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>This example demonstrates how a task chain that simulates the sequence of activities described in the <a class="reference external" href="https://github.com/eclipse-score/inc_feo/blob/main/components/feo/docs/architecture/architecture.rst">fixed execution order framework</a> can be implemented using the Runtime.</p>
<p>Assume a task chain comprising seven activities, including one sender and one receiver. The dependencies among these activities are represented in the following diagram.</p>
<img alt="../../_images/task_chain.png" src="../../_images/task_chain.png" />
<p>Furthermore, let us assume that if the execution time of the task chain exceeds the predefined time budget, the Runtime must proceed to error handling. Hence, the <code class="docutils literal notranslate"><span class="pre">Program</span></code> can be outlined as follows:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Concurrency</span></code>: // init all activities</dt><dd><ul class="simple">
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity1::init()</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity2a::init()</span></code></p></li>
<li><p>...</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity5::init()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Computation</span></code>: // the main program</dt><dd><ul class="simple">
<li><p>Start the cyclic timer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Sync</span></code> stop event // wait for the termination event</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Loop</span></code>: // the main loop</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Sync</span></code> timer event // wait for the cyclic timer event</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">TryCatch</span></code>:</dt><dd><ul>
<li><dl class="simple">
<dt>Try:</dt><dd><ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Computation</span></code>:</dt><dd><ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Sequence</span></code>: // the good path: execute the task chain</dt><dd><ul>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity1::step()</span></code></p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Concurrency</span></code>:</dt><dd><ul>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Sequence</span></code>:</dt><dd><ul>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity2a::step()</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity2b::step()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Sequence</span></code>:</dt><dd><ul>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity3a::step()</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity3b::step()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity4::step()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Sequence</span></code>: // the bad path: throw on timeout</dt><dd><ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Sleep</span></code> until deadline</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Throw</span></code> the timeout exception</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Catch:</dt><dd><ul>
<li><p>// error handling</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">Concurrency</span></code>: // shutdown all activities</dt><dd><ul class="simple">
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity1::shutdown()</span></code></p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity2a::shutdown()</span></code></p></li>
<li><p>...</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">activity5::shutdown()</span></code></p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</section>
<section id="code-walkthrough">
<h2>Code Walkthrough<a class="headerlink" href="#code-walkthrough" title="Link to this heading">¶</a></h2>
<p>As usual, we start by importing the necessary qor-runtime items.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// import the required qor-runtime items to be used in this scope</span>
<span class="k">use</span><span class="w"> </span><span class="n">qor_rto</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
</pre></div>
</div>
<p>We define the <code class="docutils literal notranslate"><span class="pre">Activity</span></code> struct and its methods.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// define the Activity</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">Activity</span>
<span class="w">    </span><span class="c1">// some fields</span>
<span class="p">}</span>

<span class="c1">// define its methods</span>
<span class="k">impl</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="p">{</span>
<span class="w">     </span><span class="k">fn</span><span class="w"> </span><span class="nf">init</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RoutineResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// statements to be called during initialization</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">fn</span><span class="w"> </span><span class="nf">step</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RoutineResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// statements to be called cyclically</span>
<span class="w">     </span><span class="p">}</span>

<span class="w">     </span><span class="k">fn</span><span class="w"> </span><span class="nf">shutdown</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">RoutineResult</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// statements to be called during shutdown</span>
<span class="w">     </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, we define a cyclic timer that triggers the execution of the task chain periodically.
The timer is simply implemented as an endless loop that triggers the timer event and suspends its execution until the specified period has elapsed.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="k">fn</span><span class="w"> </span><span class="nf">cyclic_timer</span><span class="o">&lt;</span><span class="n">Adapter</span><span class="p">:</span><span class="w"> </span><span class="nc">EventAdapter</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&#39;</span><span class="nb">static</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">    </span><span class="n">period</span><span class="p">:</span><span class="w"> </span><span class="nc">Duration</span><span class="p">,</span>
<span class="w">    </span><span class="n">notifier</span><span class="p">:</span><span class="w"> </span><span class="nc">Notifier</span><span class="o">&lt;</span><span class="n">Adapter</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="k">dyn</span><span class="w"> </span><span class="n">Action</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Loop</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">with_body</span><span class="p">(</span>
<span class="w">        </span><span class="n">Sequence</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span><span class="n">Sleep</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">period</span><span class="p">))</span>
<span class="w">            </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span><span class="n">Trigger</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">notifier</span><span class="p">)),</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We create the Runtime <code class="docutils literal notranslate"><span class="pre">Engine</span></code> and declare the activities and events in the <code class="docutils literal notranslate"><span class="pre">main</span></code> function.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// The engine is the central runtime executor</span>
<span class="kd">let</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Engine</span><span class="p">::</span><span class="n">default</span><span class="p">();</span>
<span class="n">engine</span><span class="p">.</span><span class="n">start</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>

<span class="c1">// timer syncronization event</span>
<span class="kd">let</span><span class="w"> </span><span class="n">timer_event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SingleEvent</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="c1">// our termination event</span>
<span class="kd">let</span><span class="w"> </span><span class="n">stop_event</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SingleEvent</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>

<span class="c1">// our activities &amp; clones for move into the async closures</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;1 Receiver&quot;</span><span class="p">)));</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_2a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;2a&quot;</span><span class="p">)));</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_2b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;2b&quot;</span><span class="p">)));</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_3a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;3a&quot;</span><span class="p">)));</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_3b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;3b&quot;</span><span class="p">)));</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;4&quot;</span><span class="p">)));</span>
<span class="kd">let</span><span class="w"> </span><span class="n">activity_5</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Arc</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Mutex</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">Activity</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="s">&quot;5 Sender&quot;</span><span class="p">)));</span>
</pre></div>
</div>
<dl class="simple">
<dt>Now we define our <code class="docutils literal notranslate"><span class="pre">Program</span></code> and create a <code class="docutils literal notranslate"><span class="pre">Sequence</span></code> that encompasses:</dt><dd><ul class="simple">
<li><p>the initialization block</p></li>
<li><p>the main program block</p></li>
<li><p>the shutdown block</p></li>
</ul>
</dd>
</dl>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// Create a new program with a timer, a model function and a termination event</span>
<span class="kd">let</span><span class="w"> </span><span class="n">program</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Program</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">with_action</span><span class="p">(</span>
<span class="w">    </span><span class="n">Sequence</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">          </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="c1">// initialization block</span>
<span class="w">       </span><span class="p">)</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">          </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="c1">// main program block</span>
<span class="w">       </span><span class="p">)</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">          </span><span class="o">..</span><span class="p">.</span><span class="w"> </span><span class="c1">// shutdown block</span>
<span class="w">       </span><span class="p">)</span>
</pre></div>
</div>
<p>In the initialization block, we invoke all the <cite>init()</cite> methods of the activities.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">    </span><span class="n">Concurrency</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_1</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_2a</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_2b</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_3a</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_3b</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_4</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_5</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">init</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>The main program block encompasses the following actions, i.e., <code class="docutils literal notranslate"><span class="pre">branches</span></code>:</dt><dd><ul class="simple">
<li><p>Start the cyclic timer</p></li>
<li><p>Await a stop event</p></li>
<li><p>Run the main loop</p></li>
</ul>
</dd>
</dl>
<p>Note that both the cyclic timer and the main loop run as infinite loops. To ensure that the main program can terminate upon receiving a stop event notification, we implement those concurrent actions as a <code class="docutils literal notranslate"><span class="pre">Composition</span></code>. Unlike <code class="docutils literal notranslate"><span class="pre">Concurrency</span></code>, which concludes only when all associated actions have finished, a <code class="docutils literal notranslate"><span class="pre">Composition</span></code> ends when one of the actions is completed. Hence, the stop event trigger will conclude the main program and transition the execution to the next (shutdown) block.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">    </span><span class="n">Computation</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">        </span><span class="c1">// the cyclic timer action</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">cyclic_timer</span><span class="p">(</span><span class="n">PERIOD</span><span class="p">,</span><span class="w"> </span><span class="n">timer_event</span><span class="p">.</span><span class="n">notifier</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()))</span>
<span class="w">        </span><span class="c1">// the termination action</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="nb">Sync</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">stop_event</span><span class="p">.</span><span class="n">listener</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()))</span>
<span class="w">        </span><span class="c1">// the main loop</span>
<span class="w">        </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span>
<span class="w">            </span><span class="n">Loop</span><span class="p">::</span><span class="n">new</span><span class="p">().</span><span class="n">with_body</span><span class="p">(</span>
<span class="w">                </span><span class="c1">// the main loop body</span>
<span class="w">            </span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Finally, we implement the task chain execution as the main loop body. This loop remains blocked until the subsequent cyclic event is triggered by the timer.
The execution of the task chain is wrapped within a <code class="docutils literal notranslate"><span class="pre">TryCatch</span></code> action. As the name implies, a <code class="docutils literal notranslate"><span class="pre">TryCatch</span></code> action consists of a try, i.e., <code class="docutils literal notranslate"><span class="pre">with_try</span></code> block, and a catch, i.e.,  <code class="docutils literal notranslate"><span class="pre">with_catch</span></code> one.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// wait for the cyclic timer event</span>
<span class="p">.</span><span class="n">with_step</span><span class="p">(</span><span class="nb">Sync</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">timer_event</span><span class="p">.</span><span class="n">listener</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()))</span>
<span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">    </span><span class="n">TryCatch</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">ExecutionExceptionFilter</span><span class="p">::</span><span class="n">for_timeout</span><span class="p">())</span>
<span class="w">    </span><span class="p">.</span><span class="n">with_try</span><span class="p">(</span>
<span class="w">        </span><span class="c1">// the normal execution</span>
<span class="w">    </span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="n">with_catch</span><span class="p">(</span><span class="n">Invoke</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// error handling</span>
<span class="w">        </span><span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Task chain timing violation!&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">ZERO</span><span class="p">,</span><span class="w"> </span><span class="n">UpdateResult</span><span class="p">::</span><span class="n">Complete</span><span class="p">)</span>
<span class="w">    </span><span class="p">}))</span>
<span class="w"> </span><span class="p">)</span>
</pre></div>
</div>
<p>The try block is primarily responsible for executing the task chain. To determine whether the execution duration of the task chain exceeds the preconfigured deadline, we implement a <code class="docutils literal notranslate"><span class="pre">Composition</span></code> with two branches.
The first branch executes the actual task chain, while the second branch simply invokes a sleep function that waits until the deadline is reached, after which it throws a timeout exception.
If the execution of the first branch exceeds the deadline, the second branch will trigger the exception and conclude the <code class="docutils literal notranslate"><span class="pre">Computation</span></code>.
This exception is subsequently caught within the catch block of the <code class="docutils literal notranslate"><span class="pre">TryCatch</span></code> action.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="p">.</span><span class="n">with_try</span><span class="p">(</span>
<span class="w">    </span><span class="n">Computation</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span>
<span class="w">           </span><span class="c1">// the task chain execution</span>
<span class="w">       </span><span class="p">)</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span>
<span class="w">           </span><span class="c1">// in case the former branch takes longer than the DEADLINE, this branch will throw a timeout exception and conclude the ``Computation`</span>
<span class="w">           </span><span class="n">Sequence</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">               </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span><span class="n">Sleep</span><span class="p">::</span><span class="n">new</span><span class="p">(</span><span class="n">DEADLINE</span><span class="p">))</span>
<span class="w">               </span><span class="p">.</span><span class="n">with_step</span><span class="p">(</span><span class="n">Throw</span><span class="p">::</span><span class="n">new</span><span class="p">(</span>
<span class="w">                   </span><span class="n">ExecutionException</span><span class="p">::</span><span class="n">timeout</span><span class="p">(),</span>
<span class="w">               </span><span class="p">)</span>
<span class="w">           </span><span class="p">)</span>
<span class="w">       </span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The final block of the <code class="docutils literal notranslate"><span class="pre">Program</span></code> invokes the <code class="docutils literal notranslate"><span class="pre">shutdown()</span></code> method of all activities concurrently.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// terminate all activities</span>
<span class="p">.</span><span class="n">with_step</span><span class="p">(</span>
<span class="w">    </span><span class="n">Concurrency</span><span class="p">::</span><span class="n">new</span><span class="p">()</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_1</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">))</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_2a</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">))</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_2b</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">))</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_3a</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">))</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_3b</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">))</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_4</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">))</span>
<span class="w">       </span><span class="p">.</span><span class="n">with_branch</span><span class="p">(</span><span class="n">Await</span><span class="p">::</span><span class="n">new_method_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">activity_5</span><span class="p">,</span><span class="w"> </span><span class="n">Activity</span><span class="p">::</span><span class="n">terminate</span><span class="p">)),</span>
</pre></div>
</div>
<p>Finally, we start the <code class="docutils literal notranslate"><span class="pre">Program</span></code> on the Runtime engine and let it run for 5 seconds. Afterwards, we wait until the <code class="docutils literal notranslate"><span class="pre">Program</span></code> complete before shutting down the engine.</p>
<div class="highlight-rust notranslate"><div class="highlight"><pre><span></span><span class="c1">// spawn the program on the engine</span>
<span class="kd">let</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">program</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="o">&amp;</span><span class="n">engine</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="c1">// here we wait for some time</span>
<span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="p">::</span><span class="n">sleep</span><span class="p">(</span><span class="n">Duration</span><span class="p">::</span><span class="n">from_secs</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>

<span class="c1">// ok, enough</span>
<span class="n">stop_event</span><span class="p">.</span><span class="n">notifier</span><span class="p">().</span><span class="n">unwrap</span><span class="p">().</span><span class="n">notify</span><span class="p">();</span>

<span class="c1">// Wait for the program to finish</span>
<span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">handle</span><span class="p">.</span><span class="n">join</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>

<span class="fm">println!</span><span class="p">(</span><span class="s">&quot;Task chain simulation finished&quot;</span><span class="p">);</span>

<span class="c1">// Engine shutdown</span>
<span class="n">engine</span><span class="p">.</span><span class="n">shutdown</span><span class="p">().</span><span class="n">unwrap</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="how-to-run-the-code">
<h2>How to Run the Code<a class="headerlink" href="#how-to-run-the-code" title="Link to this heading">¶</a></h2>
<p>To run the example, please execute the following command within the repository directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cargo<span class="w"> </span>r<span class="w"> </span>--example<span class="w"> </span>task_chain
</pre></div>
</div>
</section>
<section id="output">
<h2>Output<a class="headerlink" href="#output" title="Link to this heading">¶</a></h2>
<p>The subsequent image illustrates an example of console output.</p>
<img alt="../../_images/task_chain_output.png" src="../../_images/task_chain_output.png" />
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Runtime</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../runtime.html">What is Runtime?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts.html">Runtime Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="simple_example_interprocess.html">Simple Inter-process Example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Task Chain Example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-walkthrough">Code Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-run-the-code">How to Run the Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output">Output</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="simple_example_interprocess.html" title="previous chapter">Simple Inter-process Example</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025 Qorix GmbH.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="../../_sources/manual/examples/task_chain.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>